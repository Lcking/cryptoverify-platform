# Replace the example domains with your real domains

app.gambleverify.com {
  encode zstd gzip
  root * /srv/www
  try_files {path} /index.html
  file_server
}

# Redirect www and apex to the canonical app domain
www.gambleverify.com {
  redir https://app.gambleverify.com{uri} 301
}

gambleverify.com {
  redir https://app.gambleverify.com{uri} 301
}

api.gambleverify.com {
  encode zstd gzip
  reverse_proxy strapi:1337 {
    # Ensure Strapi sees the original scheme/host for secure cookies
    # IMPORTANT: {scheme} here would be the upstream scheme (http). We must force https.
    header_up X-Forwarded-Proto https
    header_up X-Forwarded-Host {host}
    header_up Host {host}
    header_up X-Forwarded-Port 443
    header_up X-Forwarded-For {remote}
  }
  header /* {
    Access-Control-Allow-Origin "https://app.gambleverify.com"
    Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
    Access-Control-Allow-Headers "Origin, Content-Type, Accept, Authorization"
    Access-Control-Allow-Credentials true
  }
}
